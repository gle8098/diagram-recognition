# Упаковка приложения в один файл

В этой статье поговорим о том, как доставить приложение пользователю
в одном архиве со всеми зависимостями и питоновский интерпретатором.

Для упаковки мы используем **pyinstaller**, который за нас соберет
все нужные файлы в одну папку. Но это не компилятор --- чтобы собрать
версии под Windows и MacOS, придется его запускать под соответствующими
системами.

Для начала нужно подготовить чистый **virtual environment** с только
необходимыми pip-пакетами:

```bash
# MacOS / Linux
python -m virtualenv venv
source venv/bin/activate
# Windows
py -m virtualenv venv
venv\Scripts\activate

# Then for all platforms
pip install .
pip install pyinstaller
```

***Если вы собираете под MacOS***, установите более старую версию PyQt5.
На момент написания статьи с последней версией 5.15.4 приложение
падало.

```bash
#Only for MacOS
pip install pyqt5==5.15.3
```

Теперь соберем наше приложение. В проекте уже есть конфиг этого
процесса --- `app_ui.spec`.

```bash
pyinstaller --clean -y godr.spec
```

Процесс должен завершиться успешно. После этого появится папка `dist` с
самой сборкой. 

***Если вы собирали под Python 3.8***, то скорее всего hook для 
`matplotlib` отработал неправильно, файлы в `mpl-data` скопировались
не те. Исправим этот недочет.

```bash
rm -rf dist/godr/matplotlib/mpl-data
cp -r "$(find venv/lib -name "mpl-data")" dist/godr/matplotlib
```

Остается сжать папку `dist/godr` в zip-архив и релиз (почти) готов к
публикации.

## Комментарии к различным ОС

### Windows

На винду поставляется одна папка `godr` с тонной библиотек внутри.
Чтобы пользователь смог найти нужный исполняемый файл, хочется сделать
~~символическую ссылку~~ `README.txt`-файл, в котором говориться, что
следует искать.

### MacOS

На MacOS поставляется один красивый файл `godr.app`, что пользователь
не сможет запутаться. Но запустить он программу не сможет, потому что
~~мы не платим Apple $100 в год~~ программа не подписана специальным
сертификатом. Поэтому вместе со сборкой надо положить инструкцию,
как обойти этот запрет, она лежит в `macos-readme.txt`.
